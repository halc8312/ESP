{% extends "base.html" %}

{% block title %}ã‚´ãƒŸç®±{% endblock %}
{% block header_title %}ã‚´ãƒŸç®±{% endblock %}

{% block content %}
<div class="page-header">
    <h1>ğŸ—‘ï¸ ã‚´ãƒŸç®±</h1>
    <p style="color: #666; margin-top: 8px;">å‰Šé™¤ã‹ã‚‰30æ—¥å¾Œã«è‡ªå‹•çš„ã«å®Œå…¨å‰Šé™¤ã•ã‚Œã¾ã™</p>
</div>

{% if items %}
<form id="trashForm" method="POST">
    <div class="batch-action-bar"
        style="margin-bottom: 16px; display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
        <label style="display: flex; align-items: center; gap: 8px;">
            <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
            å…¨é¸æŠ (<span id="selectedCount">0</span>ä»¶)
        </label>

        <button type="submit" formaction="{{ url_for('trash.trash_restore') }}"
            style="background: #2e7d32; color: white; padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer;">
            â™»ï¸ å¾©å…ƒ
        </button>

        <button type="submit" formaction="{{ url_for('trash.trash_purge') }}"
            onclick="return confirm('é¸æŠã—ãŸå•†å“ã‚’å®Œå…¨ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')"
            style="background: #c62828; color: white; padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer;">
            âš ï¸ å®Œå…¨å‰Šé™¤
        </button>
    </div>

    <div class="content-card">
        <table class="product-table">
            <thead>
                <tr>
                    <th style="width: 40px;"></th>
                    <th>ã‚¿ã‚¤ãƒˆãƒ«</th>
                    <th>ä¾¡æ ¼</th>
                    <th>å‰Šé™¤æ—¥</th>
                    <th>æ®‹ã‚Šæ—¥æ•°</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr>
                    <td>
                        <input type="checkbox" name="id" value="{{ item.id }}" class="item-checkbox"
                            onchange="updateSelectedCount()">
                    </td>
                    <td>{{ item.custom_title or item.last_title }}</td>
                    <td>
                        {% if item.last_price %}
                        Â¥{{ "{:,}".format(item.last_price) }}
                        {% endif %}
                    </td>
                    <td>{{ item.deleted_at.strftime('%Y-%m-%d %H:%M') if item.deleted_at else '-' }}</td>
                    <td>
                        {% if item.days_remaining <= 7 %} <span style="color: #c62828; font-weight: bold;">{{
                            item.days_remaining }}æ—¥</span>
                            {% else %}
                            <span style="color: #666;">{{ item.days_remaining }}æ—¥</span>
                            {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</form>

{% else %}
<div class="content-card">
    <div class="content-card-body" style="text-align: center; padding: 48px;">
        <p style="color: #666; font-size: 1.1em;">ã‚´ãƒŸç®±ã¯ç©ºã§ã™</p>
        <p style="color: #999; margin-top: 8px;">å‰Šé™¤ã•ã‚ŒãŸå•†å“ã¯ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>
    </div>
</div>
{% endif %}

<script>
    function toggleSelectAll() {
        const checked = document.getElementById('selectAll').checked;
        document.querySelectorAll('.item-checkbox').forEach(cb => cb.checked = checked);
        updateSelectedCount();
    }

    function updateSelectedCount() {
        const count = document.querySelectorAll('.item-checkbox:checked').length;
        document.getElementById('selectedCount').textContent = count;
    }
</script>
{% endblock %}