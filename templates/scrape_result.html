{% extends "base.html" %}

{% block title %}ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°çµæœ{% endblock %}
{% block header_title %}å–å¾—çµæœ{% endblock %}

{% block content %}
    <a href="{{ url_for('scrape_form') }}" class="back-link">&laquo; æ¡ä»¶ã‚’å¤‰æ›´ã—ã¦å†ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°</a>

    <div class="page-header">
        <h1>ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°çµæœ</h1>
    </div>

    <!-- æ¤œç´¢URLï¼ˆãƒ¢ãƒã‚¤ãƒ«ã§ã¯æŠ˜ã‚ŠãŸãŸã¿ï¼‰ -->
    <details class="mobile-collapsible mobile-only">
        <summary class="mobile-collapsible-header">
            <span class="mobile-collapsible-title">ğŸ”— æ¤œç´¢URLè©³ç´°</span>
            <span class="mobile-collapsible-icon">â–¶</span>
        </summary>
        <div class="mobile-collapsible-content">
            <pre style="background:#f0f0f0; padding:12px; overflow-x: auto; font-size: 12px;">{{ search_url }}</pre>
            <h4>è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</h4>
            <ul style="font-size: 14px;">
                <li>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: {{ keyword }}</li>
                <li>ä¾¡æ ¼ç¯„å›²: {{ price_min }} ã€œ {{ price_max }}</li>
                <li>ã‚½ãƒ¼ãƒˆ: {{ sort }}</li>
                <li>ã‚«ãƒ†ã‚´ãƒª: {{ category }}</li>
                <li>å–å¾—ä»¶æ•°: {{ limit }}</li>
            </ul>
        </div>
    </details>

    <!-- PCç”¨è©³ç´°è¡¨ç¤º -->
    <div class="content-card desktop-only">
        <div class="content-card-header">
            <h3>æ¤œç´¢URL</h3>
        </div>
        <div class="content-card-body">
            <pre style="background:#f0f0f0; padding:12px; overflow-x: auto;">{{ search_url }}</pre>
            <h4>è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:</h4>
            <ul>
                <li>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: {{ keyword }}</li>
                <li>ä¾¡æ ¼ç¯„å›²: {{ price_min }} ã€œ {{ price_max }}</li>
                <li>ã‚½ãƒ¼ãƒˆ: {{ sort }}</li>
                <li>ã‚«ãƒ†ã‚´ãƒª: {{ category }}</li>
                <li>å–å¾—ä»¶æ•°(max_items): {{ limit }}</li>
            </ul>
        </div>
    </div>

    {% if error_msg %}
    <div class="content-card" style="border-color: var(--danger-color);">
        <div class="content-card-body">
            <p class="error" style="margin: 0;">ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {{ error_msg }}</p>
        </div>
    </div>
    {% else %}
    <!-- çµæœã‚µãƒãƒª -->
    <div class="dashboard-grid" style="grid-template-columns: repeat(3, 1fr);">
        <div class="stat-card">
            <h3>å–å¾—ä»¶æ•°</h3>
            <div class="value">{{ items|length }}</div>
        </div>
        <div class="stat-card">
            <h3>æ–°è¦ç™»éŒ²</h3>
            <div class="value" style="color: var(--success-color);">{{ new_count }}</div>
        </div>
        <div class="stat-card">
            <h3>æ›´æ–°</h3>
            <div class="value" style="color: var(--primary-color);">{{ updated_count }}</div>
        </div>
    </div>

    {% if items %}
    <div class="content-card">
        <div class="content-card-header">
            <h3>å–å¾—ã—ãŸå•†å“ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰</h3>
        </div>
        <div class="content-card-body" style="padding: 0;">
            <div class="table-responsive">
                <table>
                    <tr>
                        <th>#</th>
                        <th>ã‚¿ã‚¤ãƒˆãƒ«</th>
                        <th>ä¾¡æ ¼</th>
                        <th class="hide-mobile">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                        <th>URL</th>
                    </tr>
                    {% for it in items %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td class="product-title-cell">{{ it.title }}</td>
                        <td>
                            {% if it.price is not none %}
                            Â¥{{ "{:,}".format(it.price) }}
                            {% else %}
                            -
                            {% endif %}
                        </td>
                        <td class="hide-mobile">{{ it.status }}</td>
                        <td><a href="{{ it.url }}" target="_blank">é–‹ã</a></td>
                    </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
    </div>
    {% endif %}
    {% endif %}
{% endblock %}