<!doctype html>
<html lang="ja">
<head><meta charset="utf-8"><title>スクレイピング結果</title>
<style>
    body { font-family: sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 16px; }
    th, td { border: 1px solid #ccc; padding: 4px 8px; font-size: 13px; vertical-align: top; }
    th { background: #f0f0f0; }
    .error { color: red; font-weight: bold; }
</style>
</head>
<body>
    <h1>スクレイピング結果</h1>
    <p><a href="{{ url_for('scrape_form') }}">← 条件を変更して再スクレイピング</a> |
        <a href="{{ url_for('index') }}">商品一覧を見る →</a></p>

    <h3>使用した検索URL:</h3>
    <pre style="background:#f0f0f0; padding:12px; overflow-x: auto;">{{ search_url }}</pre>

    <h3>設定パラメータ:</h3>
    <ul>
        <li>キーワード: {{ keyword }}</li>
        <li>価格範囲: {{ price_min }} 〜 {{ price_max }}</li>
        <li>ソート: {{ sort }}</li>
        <li>カテゴリ: {{ category }}</li>
        <li>取得件数(max_items): {{ limit }}</li>
    </ul>

    {% if error_msg %}
        <p class="error">スクレイピング中にエラーが発生しました: {{ error_msg }}</p>
    {% else %}
        <p>スクレイピング取得件数: {{ items|length }} 件</p>
        <p>DB 新規登録: {{ new_count }} 件 / 更新: {{ updated_count }} 件</p>

        {% if items %}
            <h3>取得した商品（プレビュー）</h3>
            <table>
                <tr>
                    <th>#</th>
                    <th>タイトル</th>
                    <th>価格</th>
                    <th>ステータス</th>
                    <th>URL</th>
                </tr>
                {% for it in items %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>{{ it.title }}</td>
                    <td>
                        {% if it.price is not none %}
                            ¥{{ "{:,}".format(it.price) }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>{{ it.status }}</td>
                    <td><a href="{{ it.url }}" target="_blank">開く</a></td>
                </tr>
                {% endfor %}
            </table>
        {% endif %}
    {% endif %}
</body>
</html>