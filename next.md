# 引継ぎ資料

## プロジェクト概要

Shopifyおよび将来的にeBayと連携する、Eコマース出品・管理ツールの開発。
仕入れ元サイトからの商品情報スクレイピング、ツール上での情報編集（価格計算、商品説明テンプレート適用など）、Shopify用のCSV出力、在庫・価格の自動チェックといった機能を持つWebアプリケーションを構築する。

## 現状の進捗

`tasks.md` に記載の通り、当初計画した11タスクのうち9タスクが完了済み。
主要機能の実装はほぼ完了しており、現在は最終タスクであるサポート機能の実装を行っている段階。

**完了済みの主な機能:**
- 複数店舗、商品説明テンプレートに対応したDB設計
- 汎用的なスクレイピング機能の基礎（メルカリ対応済み）
- BootstrapによるUI/UXの改善
- 商品情報（タイトル、価格、説明）の編集・更新機能
- 利益率・固定額による価格自動計算機能
- 在庫・価格の変更チェックとハイライト表示
- 変更があった商品のみを対象とした更新用CSV出力機能
- 複数ショップアカウントの切り替え機能

## 現在のタスクと課題

**現在進行中のタスク:**
- No.10 チャットサポート機能

**発生している問題:**
- `app.py` にサポート用のお問い合わせフォーム機能を追加する過程で、コードの挿入箇所を誤り、複数回の修正でファイル内に構文エラーや不整合が発生している可能性がある。
- 直近では、`@app.route` デコレーターが `app = Flask(__name__)` の定義より前に配置されてしまったことによる `NameError: name 'app' is not defined` のようなエラーが発生していた。

## 次のエージェントへの依頼事項

1.  **`app.py` の健全化:**
    - `app.py` のファイル全体の構造を改めて精査し、サポート機能 (`/support` ルート、`send_support_email` 関数など) が `app = Flask(__name__)` の定義後、かつ他のルート定義と同じ適切なスコープに配置されるようにコードを修正・整理してください。
    - 修正後、Flaskが正常に起動し、すべての既存ページ (`/`, `/scrape`, `/shops` など) が問題なく表示されることを確認してください。

2.  **サポート機能の実装完了:**
    - `app.py` の修正後、サポートページ (`/support`) が正しく表示され、フォームからメッセージを送信できることを確認してください。
    - (現状は`print`でログ出力) メール送信機能が動作するように、SMTP関連の環境変数を設定し、テストを行ってください。

3.  **UIの統一:**
    - 現在、新しいナビゲーションバー（ショップ選択ドロップダウン付き）が適用されているのは一部のページのみです。`app.py` 内のすべてのHTMLテンプレートで、この共通ナビゲーションバーが使用されるように修正し、UIを統一してください。

4.  **タスクの完了:**
    - 上記がすべて完了したら、`tasks.md` のタスクNo.10にチェックを入れてください。

5.  **最終レビュー:**
    - 全機能を通して動作確認を行い、問題がなければ開発完了としてください。

## 主要ファイル

- `app.py`: メインのFlaskアプリケーション、DBモデル、すべてのルート定義
- `scrapers.py`: スクレイピングロジック（旧 `mercari_db.py`）
- `tasks.md`: 開発タスクリスト
- `static/`: Bootstrapなどの静的ファイル

以上、よろしくお願いいたします。
