# 開発ステータスと今後の計画 (2025-12-14 更新)

このドキュメントは、Shopify CSV出力機能および在庫管理ツールの実装状況と、今後の開発計画をまとめたものです。

## 実装済み機能一覧

### 1. 商品スクレイピング & 登録
- **検索一括抽出**: キーワード、価格帯、カテゴリを指定してメルカリから商品を一括取得。
- **単品URL抽出**: 商品URLを直接指定して1件ずつ取得。
- **SKU自動生成**: 登録時に `MER-{URLハッシュ(10桁)}` の形式で固有SKUを自動付与。
- **画像保存**: メルカリの画像をダウンロードし、ローカル（永続ディスク）で管理・配信。

### 2. 商品データ管理 (Web UI)
- **基本情報編集**: タイトル、説明文（テンプレート機能あり）、タグ、Vendorなど。
- **SEO設定**: URLハンドル、meta title, meta description。
- **配送・関税**: 重量(Grams)、HSコード、原産国。
- **課税設定**: デフォルトで `Taxable: False` (非課税) に設定。
- **バリエーション管理**:
    - バリエーション行の自由な追加・削除が可能。
    - オプション名（Option1 Name等）の編集が可能。
- **ショップ管理 (複数アカウント対応)**:
    - 複数のShopify店舗を想定し、商品を「ショップ」ごとにグループ分けして管理可能。
    - CSVエクスポート時も選択中のショップの商品のみを出力。

### 3. CSVエクスポート
- **Shopify商品登録CSV**: 新規出品・更新用。画像URLも自社サーバー経由のものに変換して出力。
- **Shopify在庫更新CSV**: `Handle` と `Variant Inventory Qty` のみを出力。
- **Shopify価格更新CSV**: `Handle` と `Variant Price` のみを出力。
- **eBay File Exchange CSV**: 最小限のItem Specificsと価格計算（為替レート+利益率）に対応。

### 4. 自動在庫・価格チェック (CLI)
- **コマンド**: `flask update-products`
- **機能**: 登録済みの全商品URLを巡回し、価格変更や「売り切れ」ステータスを検知してDBを更新。
- **運用**: Render等のCron Jobで定期実行することを想定。

---

## 機能実装ステータス詳細

| 機能項目 | ステータス | 備考 |
| :--- | :--- | :--- |
| **Title（商品名）** | ✅ 実装済み | 編集・出力に対応 |
| **Body（商品説明）** | ✅ 実装済み | テンプレート機能あり |
| **Images（画像）** | ✅ 実装済み | ローカルキャッシュ・配信URL生成に対応 |
| **Variant Price（価格）** | ✅ 実装済み | 利益率計算・為替レート変換に対応 |
| **Variant Inventory Qty** | ✅ 実装済み | 在庫更新CSVに対応 |
| **Status（ステータス）** | ✅ 実装済み | `active` / `draft` / `sold` (自動検知) |
| **SKU自動生成** | ✅ 実装済み | URLハッシュベースで自動生成 |
| **複数ショップ管理** | ✅ 実装済み | ショップごとの商品管理・CSV出力 |
| **自動更新 (CLI)** | ✅ 実装済み | `flask update-products` |
| **単品URL取込** | ✅ 実装済み | |
| **複数バリエーション** | ✅ 実装済み | DB構造変更・CSV出力対応済み |

---

## 今後の開発計画

### Next Step: 認証とセキュリティ
- **ログイン機能**: ✅ 実装済み (Flask-Login, Password Hash)
- **アクセス制御**: ✅ 実装済み (必須認証ルートの設定)

### 直近のアップデート (2025-12-16)
- **Mercari Shops対応**: 
    - バリエーション（色・サイズ）の取得ロジックを抜本的に改善。
    - 兄弟要素（Sibling）解析と正規表現によるクリーニングを実装し、多様なDOM構造に対応。
- **データ保存修正**:
    - 複数オプション（Option1, Option2）の組み合わせを正しくDBにマッピングするよう修正。

### その他 検討事項
- **画像編集**: トリミングやリサイズ機能。
- **一括編集**: 商品一覧でのステータス一括変更など。
